---
import Layout from "../../layouts/Layout.astro";
import { SITE_DOMAIN, SITE_TITLE, EVENT_DATE } from "../../consts";
import {
  getSortedSessions,
  formatTime,
  getLanguageLabel,
  getLevelLabel,
  getSpeakerSlug,
  markdownToHtml,
  i18n,
} from "../../utils/schedule";

const locale = "fr";
const t = i18n[locale];
const sortedSessions = getSortedSessions();

const schema = {
  "@context": "https://schema.org",
  "@type": "Event",
  name: SITE_TITLE,
  startDate: EVENT_DATE,
  location: {
    "@type": "Place",
    name: "Sorbonne UniversitÃ© - Campus Pierre et Marie Curie",
    address: {
      "@type": "PostalAddress",
      streetAddress: "4 place Jussieu",
      addressLocality: "Paris",
      postalCode: "75005",
      addressCountry: "FR",
    },
  },
  url: `${SITE_DOMAIN}/fr/schedule`,
  description: "Programme de la confÃ©rence NG Baguette 2026",
};
---

<Layout title="Agenda" schema={schema}>
  <main>
    <!-- Hero Section -->
    <div
      class="relative bg-gradient-to-br from-primary/20 via-base-200 to-secondary/20 py-16"
    >
      <div
        class="absolute inset-0 bg-[url('/cfp-conference.jpg')] bg-cover bg-center opacity-10"
      >
      </div>
      <div class="relative max-w-screen-lg mx-auto px-4 md:px-8 text-center">
        <div
          class="inline-flex items-center gap-2 bg-primary/10 text-primary px-4 py-2 rounded-full mb-6"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect>
            <line x1="16" x2="16" y1="2" y2="6"></line>
            <line x1="8" x2="8" y1="2" y2="6"></line>
            <line x1="3" x2="21" y1="10" y2="10"></line>
          </svg>
          <span class="font-semibold">29 Mai 2026</span>
        </div>
        <h1 class="text-4xl md:text-6xl font-bold mb-4 title-font">Agenda</h1>
        <p class="text-lg md:text-xl text-base-content/70 max-w-2xl mx-auto">
          DÃ©couvrez le programme complet de la confÃ©rence NG Baguette 2026
        </p>
        <div class="flex justify-center gap-4 mt-8">
          <div class="stat bg-base-100/50 backdrop-blur rounded-xl px-6 py-4">
            <div class="stat-value text-primary text-3xl">
              {sortedSessions.length - 1}
            </div>
            <div class="stat-desc">Sessions</div>
          </div>
          <div class="stat bg-base-100/50 backdrop-blur rounded-xl px-6 py-4">
            <div class="stat-value text-secondary text-3xl">
              {
                new Set(
                  sortedSessions.flatMap(
                    (s) => s.proposal?.speakers?.map((sp) => sp.id) || [],
                  ),
                ).size
              }
            </div>
            <div class="stat-desc">Speakers</div>
          </div>
        </div>
      </div>
    </div>

    <section class="max-w-screen-lg mx-auto px-4 md:px-8 py-12">
      <div class="space-y-6">
        {
          sortedSessions.map((session) => (
            <div class="card bg-base-200 shadow-xl overflow-hidden">
              {/* Time Banner */}
              <div class="bg-primary text-primary-content px-6 py-3 flex items-center justify-between flex-wrap gap-2">
                <div class="flex items-center gap-3">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <circle cx="12" cy="12" r="10" />
                    <polyline points="12 6 12 12 16 14" />
                  </svg>
                  <span class="font-mono font-bold text-lg">
                    {formatTime(session.start, locale)} -{" "}
                    {formatTime(session.end, locale)}
                  </span>
                </div>
              </div>

              <div class="card-body">
                <h2 class="card-title text-xl md:text-2xl mb-3">
                  {session.title}
                </h2>

                {session.proposal && (
                  <div class="flex flex-wrap gap-2 mb-4">
                    {session.language && (
                      <span class="badge badge-lg gap-2">
                        {session.language === "fr" ? "ðŸ‡«ðŸ‡·" : "ðŸ‡¬ðŸ‡§"}
                        {
                          getLanguageLabel(session.language, locale).split(
                            " ",
                          )[1]
                        }
                      </span>
                    )}
                    <span class="badge badge-lg badge-secondary badge-outline gap-2">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="14"
                        height="14"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                      </svg>
                      {getLevelLabel(session.proposal.level, locale)}
                    </span>
                  </div>
                )}

                {session.proposal?.speakers &&
                  session.proposal.speakers.length > 0 && (
                    <div class="flex flex-wrap gap-4 my-4">
                      {session.proposal.speakers.map((speaker) => (
                        <a
                          href={`/${locale}/speaker/${getSpeakerSlug(speaker)}`}
                          class="flex items-center gap-4 bg-base-100 hover:bg-base-300 rounded-xl p-3 transition-all hover:scale-[1.02] hover:shadow-md"
                        >
                          <div class="avatar">
                            <div class="w-14 h-14 rounded-xl ring-2 ring-primary/30">
                              <img
                                src={speaker.picture}
                                alt={speaker.name}
                                loading="lazy"
                              />
                            </div>
                          </div>
                          <div>
                            <p class="font-semibold text-lg">{speaker.name}</p>
                            {speaker.company && (
                              <p class="text-sm text-base-content/60 flex items-center gap-1">
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  width="12"
                                  height="12"
                                  viewBox="0 0 24 24"
                                  fill="none"
                                  stroke="currentColor"
                                  stroke-width="2"
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                >
                                  <path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z" />
                                  <path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2" />
                                  <path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2" />
                                </svg>
                                {speaker.company}
                              </p>
                            )}
                          </div>
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="text-primary ml-auto"
                          >
                            <path d="m9 18 6-6-6-6" />
                          </svg>
                        </a>
                      ))}
                    </div>
                  )}

                {session.proposal && (
                  <div class="bg-base-100 rounded-xl p-5 mt-2">
                    <h3 class="font-semibold mb-3 text-base-content/70 uppercase text-sm tracking-wide flex items-center gap-2">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="text-primary"
                      >
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                      </svg>
                      {t.viewAbstract}
                    </h3>
                    <div class="text-base-content/80 leading-relaxed prose prose-sm max-w-none" set:html={markdownToHtml(session.proposal.abstract)} />
                  </div>
                )}
              </div>
            </div>
          ))
        }
      </div>
    </section>
  </main>
</Layout>

<style>
  .title-font {
    font-family: "Bangers", sans-serif;
  }
</style>
<style is:global>
  .prose p {
    margin-bottom: 1em;
  }
  .prose blockquote {
    border-left: 4px solid hsl(var(--p));
    padding-left: 1em;
    margin: 1em 0;
    font-style: italic;
  }
</style>
